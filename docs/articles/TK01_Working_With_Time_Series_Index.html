<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with the Time Series Index using timetk • timetk</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Working with the Time Series Index using timetk">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-76139189-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-76139189-2');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">timetk</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/TK03_Forecasting_Using_Time_Series_Signature.html">Time Series Machine Learning</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Plotting</li>
    <li class="divider">
    <li class="dropdown-header">Time Series Helpers</li>
    <li>
      <a href="../articles/TK00_Time_Series_Coercion.html">Time series conversion</a>
    </li>
    <li>
      <a href="../articles/TK01_Working_With_Time_Series_Index.html">Time series index</a>
    </li>
    <li>
      <a href="../articles/TK02_Making_A_Future_Time_Series_Index.html">Creating future time series indices</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Function Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/business-science/timetk">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Working with the Time Series Index using timetk</h1>
                        <h4 class="author">Matt Dancho</h4>
            
            <h4 class="date">2020-04-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/business-science/timetk/blob/master/vignettes/TK01_Working_With_Time_Series_Index.Rmd"><code>vignettes/TK01_Working_With_Time_Series_Index.Rmd</code></a></small>
      <div class="hidden name"><code>TK01_Working_With_Time_Series_Index.Rmd</code></div>

    </div>

    
    
<blockquote>
<p>A collection of tools for working with time series in R</p>
</blockquote>
<p>The <strong>time series index</strong>, which consists of a collection of time-based values that define <em>when</em> each observation occurred, is the most important part of a time series object. The index gives the user a lot of information in a simple timestamp. Consider the datetime “2016-01-01 00:00:00”. From this timestamp, we can decompose the datetime to get the <strong>signature</strong>, which consists of the year, quarter, month, day, day of year, day of month, hour, minute, and second of the occurrence of a single observation. Further, the difference between two or more observations is the <strong>frequency</strong> from which we can obtain even more information such as the periodicity of the data and whether or not these observations are on a regular interval. This information is critical as it provides the basis for performance over time in finance, decay rates in biology, growth rates in economics, and so on.</p>
<p>In this vignette the user will be exposed to the time series index, tools to gain insights and work with it, and methods to work with time series data in general. The user will see several functions that can help to efficiently extract and analyze a time series index. Further, the user will see how to decompose an index (i.e. create a signature) and how to efficiently add the signature to a time series object (<code>tbl</code> with time basis, <code>xts</code> or <code>zoo</code> objects). In addition, the user will learn about summary metrics.</p>
<div id="prerequisites" class="section level1">
<h1 class="hasAnchor">
<a href="#prerequisites" class="anchor"></a>Prerequisites</h1>
<p>Before we get started, load the following packages.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyquant)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(timetk)</a></code></pre></div>
</div>
<div id="data" class="section level1">
<h1 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h1>
<p>We’ll use the Facebook stock prices from the <code>FANG</code> data set from <code>tidyquant</code>. These are the historical stock prices (open, high, low, close, volume, and adjusted) for the “FB” stock from 2013 through 2016.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">FB_tbl &lt;-<span class="st"> </span>FANG <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(symbol <span class="op">==</span><span class="st"> "FB"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">FB_tbl</a></code></pre></div>
<pre><code>## # A tibble: 1,008 x 8
##    symbol date        open  high   low close    volume adjusted
##    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 FB     2013-01-02  27.4  28.2  27.4  28    69846400     28  
##  2 FB     2013-01-03  27.9  28.5  27.6  27.8  63140600     27.8
##  3 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8
##  4 FB     2013-01-07  28.7  29.8  28.6  29.4  83781800     29.4
##  5 FB     2013-01-08  29.5  29.6  28.9  29.1  45871300     29.1
##  6 FB     2013-01-09  29.7  30.6  29.5  30.6 104787700     30.6
##  7 FB     2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3
##  8 FB     2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7
##  9 FB     2013-01-14  32.1  32.2  30.6  31.0  98892800     31.0
## 10 FB     2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1
## # … with 998 more rows</code></pre>
<p>To simplify the tutorial, we will select only the “date” and “volume” columns. For the <code>FB_vol_date</code> data frame, we can see from the “date” column that the observations are <em>daily</em> beginning on the second day of 2013.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">FB_vol_date &lt;-<span class="st"> </span>FB_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(date, volume)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">FB_vol_date</a></code></pre></div>
<pre><code>## # A tibble: 1,008 x 2
##    date          volume
##    &lt;date&gt;         &lt;dbl&gt;
##  1 2013-01-02  69846400
##  2 2013-01-03  63140600
##  3 2013-01-04  72715400
##  4 2013-01-07  83781800
##  5 2013-01-08  45871300
##  6 2013-01-09 104787700
##  7 2013-01-10  95316400
##  8 2013-01-11  89598000
##  9 2013-01-14  98892800
## 10 2013-01-15 173242600
## # … with 998 more rows</code></pre>
<p>To show examples using alternative time series classes, we’ll summarize the data as <code>yearqtr</code> from the <code>zoo</code> package. We now see from the “date” column that the observations are <em>quarterly</em> beginning on the first quarter of 2013.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">FB_vol_yearqtr &lt;-<span class="st"> </span>FB_vol_date <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">as.yearqtr</span>(date)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">    </span><span class="kw">group_by</span>(date) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">volume =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(volume))</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">FB_vol_yearqtr</a></code></pre></div>
<pre><code>## # A tibble: 16 x 2
##    date          volume
##    &lt;yearqtr&gt;      &lt;dbl&gt;
##  1 2013 Q1   3360672000
##  2 2013 Q2   2508935500
##  3 2013 Q3   4366095000
##  4 2013 Q4   4907480100
##  5 2014 Q1   3660928900
##  6 2014 Q2   3867510400
##  7 2014 Q3   2340124400
##  8 2014 Q4   2109135400
##  9 2015 Q1   1596531700
## 10 2015 Q2   1501555300
## 11 2015 Q3   2135807400
## 12 2015 Q4   1558813800
## 13 2016 Q1   2188123300
## 14 2016 Q2   1652751000
## 15 2016 Q3   1212297600
## 16 2016 Q4   1361185100</code></pre>
</div>
<div id="extract-an-index" class="section level1">
<h1 class="hasAnchor">
<a href="#extract-an-index" class="anchor"></a>Extract an index</h1>
<div id="tk_index" class="section level2">
<h2 class="hasAnchor">
<a href="#tk_index" class="anchor"></a>tk_index</h2>
<p>Before we can analyze an index, we need to extract it from the object. The function <code><a href="../reference/tk_index.html">tk_index()</a></code> extracts the index from any time series object including data frame (or <code>tbl</code>), <code>xts</code>, <code>zoo</code>, etc. The index is always returned in the native date, datetime, yearmon, or yearqtr format. Note that the index must be in one of these time-based classes for extraction to work:</p>
<ul>
<li>datetimes: Must inherit <code>POSIXt</code>
</li>
<li>dates: Must inherit <code>Date</code>
</li>
<li>yearmon: Must inherit <code>yearmon</code> from the <code>zoo</code> package</li>
<li>yearqtr: Must inherit <code>yearqtr</code> from the <code>zoo</code> package</li>
</ul>
<p>Extract the index using <code><a href="../reference/tk_index.html">tk_index()</a></code>. The structure is shown to see the output format, which is a vector of dates.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># idx_date</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">idx_date &lt;-<span class="st"> </span><span class="kw"><a href="../reference/tk_index.html">tk_index</a></span>(FB_vol_date)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(idx_date)</a></code></pre></div>
<pre><code>##  Date[1:1008], format: "2013-01-02" "2013-01-03" "2013-01-04" "2013-01-07" "2013-01-08" ...</code></pre>
<p>We can see a similar result with the yearqtr index. The obvious differences are fewer observations since the time series was aggregated quarterly and the output format is the <code>yearqtr</code> class.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># idx_yearqtr</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">idx_yearqtr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/tk_index.html">tk_index</a></span>(FB_vol_yearqtr)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"class: "</span>, <span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(idx_yearqtr), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>,</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">       <span class="st">"n.obs: "</span>, <span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(idx_yearqtr), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>,</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">       <span class="st">"head:  "</span>, stringr<span class="op">::</span><span class="kw"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span>(<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(idx_yearqtr), <span class="dt">collapse =</span> <span class="st">", "</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="st">    </span><span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>()</a></code></pre></div>
<pre><code>## class: yearqtr
## n.obs: 16
## head:  2013 Q1, 2013 Q2, 2013 Q3, 2013 Q4, 2014 Q1, 2014 Q2</code></pre>
</div>
</div>
<div id="analyze-the-index" class="section level1">
<h1 class="hasAnchor">
<a href="#analyze-the-index" class="anchor"></a>Analyze the index</h1>
<div id="tk_get_timeseries_signature-and-tk_augment_timeseries_signature" class="section level2">
<h2 class="hasAnchor">
<a href="#tk_get_timeseries_signature-and-tk_augment_timeseries_signature" class="anchor"></a>tk_get_timeseries_signature and tk_augment_timeseries_signature</h2>
<p>The index can be decomposed into a <em>signature</em>. The time series signature is a unique set of properties of the time series values that describe the time series. The function <code><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_signature()</a></code> can be used to convert the index to a tibble containing the following values (columns):</p>
<ul>
<li>
<strong>index</strong>: The index value that was decomposed</li>
<li>
<strong>index.num</strong>: The numeric value of the index in seconds. The base is “1970-01-01 00:00:00” (Execute <code>"1970-01-01 00:00:00" %&gt;% ymd_hms() %&gt;% as.numeric()</code> to see the value returned is zero). Every time series value after this date can be converted to a numeric value in seconds.</li>
<li>
<strong>diff</strong>: The difference in seconds from the previous numeric index value.</li>
<li>
<strong>year</strong>: The year component of the index.</li>
<li>
<strong>year.iso</strong>: The ISO year number of the year (Monday start).</li>
<li>
<strong>half</strong>: The half component of the index.</li>
<li>
<strong>quarter</strong>: The quarter component of the index.</li>
<li>
<strong>month</strong>: The month component of the index with base 1.</li>
<li>
<strong>month.xts</strong>: The month component of the index with base 0, which is what <code>xts</code> implements.</li>
<li>
<strong>month.lbl</strong>: The month label as an ordered factor begining with January and ending with December.</li>
<li>
<strong>day</strong>: The day component of the index.</li>
<li>
<strong>hour</strong>: The hour component of the index.</li>
<li>
<strong>minute</strong>: The minute component of the index.</li>
<li>
<strong>second</strong>: The second component of the index.</li>
<li>
<strong>hour12</strong>: The hour component on a 12 hour scale.</li>
<li>
<strong>am.pm</strong>: Morning (AM) = 1, Afternoon (PM) = 2.</li>
<li>
<strong>wday</strong>: The day of the week with base 1. Sunday = 1 and Saturday = 7.</li>
<li>
<strong>wday.xts</strong>: The day of the week with base 0, which is what <code>xts</code> implements. Sunday = 0 and Saturday = 6.</li>
<li>
<strong>wday.lbl</strong>: The day of the week label as an ordered factor begining with Sunday and ending with Saturday.</li>
<li>
<strong>mday</strong>: The day of the month.</li>
<li>
<strong>qday</strong>: The day of the quarter.</li>
<li>
<strong>yday</strong>: The day of the year.</li>
<li>
<strong>mweek</strong>: The week of the month.</li>
<li>
<strong>week</strong>: The week number of the year (Sunday start).</li>
<li>
<strong>week.iso</strong>: The ISO week number of the year (Monday start).</li>
<li>
<strong>week2</strong>: The modulus for bi-weekly frequency.</li>
<li>
<strong>week3</strong>: The modulus for tri-weekly frequency.</li>
<li>
<strong>week4</strong>: The modulus for quad-weekly frequency.</li>
<li>
<strong>mday7</strong>: The integer division of day of the month by seven, which returns the first, second, third, … instance the day has appeared in the month. Values begin at 1. For example, the first Saturday in the month has mday7 = 1. The second has mday7 = 2.</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># idx_date signature</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_signature</a></span>(idx_date)</a></code></pre></div>
<pre><code>## # A tibble: 1,008 x 29
##    index      index.num   diff  year year.iso  half quarter month month.xts
##    &lt;date&gt;         &lt;int&gt;  &lt;int&gt; &lt;int&gt;    &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;     &lt;int&gt;
##  1 2013-01-02    1.36e9     NA  2013     2013     1       1     1         0
##  2 2013-01-03    1.36e9  86400  2013     2013     1       1     1         0
##  3 2013-01-04    1.36e9  86400  2013     2013     1       1     1         0
##  4 2013-01-07    1.36e9 259200  2013     2013     1       1     1         0
##  5 2013-01-08    1.36e9  86400  2013     2013     1       1     1         0
##  6 2013-01-09    1.36e9  86400  2013     2013     1       1     1         0
##  7 2013-01-10    1.36e9  86400  2013     2013     1       1     1         0
##  8 2013-01-11    1.36e9  86400  2013     2013     1       1     1         0
##  9 2013-01-14    1.36e9 259200  2013     2013     1       1     1         0
## 10 2013-01-15    1.36e9  86400  2013     2013     1       1     1         0
## # … with 998 more rows, and 20 more variables: month.lbl &lt;ord&gt;, day &lt;int&gt;,
## #   hour &lt;int&gt;, minute &lt;int&gt;, second &lt;int&gt;, hour12 &lt;int&gt;, am.pm &lt;int&gt;,
## #   wday &lt;int&gt;, wday.xts &lt;int&gt;, wday.lbl &lt;ord&gt;, mday &lt;int&gt;, qday &lt;int&gt;,
## #   yday &lt;int&gt;, mweek &lt;int&gt;, week &lt;int&gt;, week.iso &lt;int&gt;, week2 &lt;int&gt;,
## #   week3 &lt;int&gt;, week4 &lt;int&gt;, mday7 &lt;int&gt;</code></pre>
<p>We can also get the signature of other time-based objects. The <code><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_signature()</a></code> function works with date, datetime, yearmon, and yearqtr vectors.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co"># idx_yearqtr signature</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_signature</a></span>(idx_yearqtr)</a></code></pre></div>
<pre><code>## # A tibble: 16 x 29
##    index index.num    diff  year year.iso  half quarter month month.xts
##    &lt;yea&gt;     &lt;int&gt;   &lt;int&gt; &lt;int&gt;    &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;     &lt;int&gt;
##  1 2013…    1.36e9      NA  2013     2013     1       1     1         0
##  2 2013…    1.36e9 7776000  2013     2013     1       2     4         3
##  3 2013…    1.37e9 7862400  2013     2013     2       3     7         6
##  4 2013…    1.38e9 7948800  2013     2013     2       4    10         9
##  5 2014…    1.39e9 7948800  2014     2014     1       1     1         0
##  6 2014…    1.40e9 7776000  2014     2014     1       2     4         3
##  7 2014…    1.40e9 7862400  2014     2014     2       3     7         6
##  8 2014…    1.41e9 7948800  2014     2014     2       4    10         9
##  9 2015…    1.42e9 7948800  2015     2015     1       1     1         0
## 10 2015…    1.43e9 7776000  2015     2015     1       2     4         3
## 11 2015…    1.44e9 7862400  2015     2015     2       3     7         6
## 12 2015…    1.44e9 7948800  2015     2015     2       4    10         9
## 13 2016…    1.45e9 7948800  2016     2015     1       1     1         0
## 14 2016…    1.46e9 7862400  2016     2016     1       2     4         3
## 15 2016…    1.47e9 7862400  2016     2016     2       3     7         6
## 16 2016…    1.48e9 7948800  2016     2016     2       4    10         9
## # … with 20 more variables: month.lbl &lt;ord&gt;, day &lt;int&gt;, hour &lt;int&gt;,
## #   minute &lt;int&gt;, second &lt;int&gt;, hour12 &lt;int&gt;, am.pm &lt;int&gt;, wday &lt;int&gt;,
## #   wday.xts &lt;int&gt;, wday.lbl &lt;ord&gt;, mday &lt;int&gt;, qday &lt;int&gt;, yday &lt;int&gt;,
## #   mweek &lt;int&gt;, week &lt;int&gt;, week.iso &lt;int&gt;, week2 &lt;int&gt;, week3 &lt;int&gt;,
## #   week4 &lt;int&gt;, mday7 &lt;int&gt;</code></pre>
<p>It’s usually important to keep the index signature with the values (e.g. volume in our example). We can use an expedited approach with <code><a href="../reference/tk_augment_timeseries.html">tk_augment_timeseries_signature()</a></code>, which adds the signature to the end of the time series object. Note that <code>xts</code> and <code>zoo</code> objects only retain numeric columns and therefore “month.lbl” and “wday.lbl” columns will be dropped. We’ll use the <code><a href="../reference/tk_augment_timeseries.html">tk_augment_timeseries_signature()</a></code> function on the dataframe <code>FB_vol_date</code> which contains the date and volume columns.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co"># Augmenting a data frame</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">FB_vol_date_signature &lt;-<span class="st"> </span><span class="kw"><a href="../reference/tk_augment_timeseries.html">tk_augment_timeseries_signature</a></span>(FB_vol_date)</a></code></pre></div>
<pre><code>## tk_augment_timeseries_signature(): Using the following .date_var variable: date</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">FB_vol_date_signature</a></code></pre></div>
<pre><code>## # A tibble: 1,008 x 30
##    date       volume index.num   diff  year year.iso  half quarter month
##    &lt;date&gt;      &lt;dbl&gt;     &lt;int&gt;  &lt;int&gt; &lt;int&gt;    &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;
##  1 2013-01-02 6.98e7    1.36e9     NA  2013     2013     1       1     1
##  2 2013-01-03 6.31e7    1.36e9  86400  2013     2013     1       1     1
##  3 2013-01-04 7.27e7    1.36e9  86400  2013     2013     1       1     1
##  4 2013-01-07 8.38e7    1.36e9 259200  2013     2013     1       1     1
##  5 2013-01-08 4.59e7    1.36e9  86400  2013     2013     1       1     1
##  6 2013-01-09 1.05e8    1.36e9  86400  2013     2013     1       1     1
##  7 2013-01-10 9.53e7    1.36e9  86400  2013     2013     1       1     1
##  8 2013-01-11 8.96e7    1.36e9  86400  2013     2013     1       1     1
##  9 2013-01-14 9.89e7    1.36e9 259200  2013     2013     1       1     1
## 10 2013-01-15 1.73e8    1.36e9  86400  2013     2013     1       1     1
## # … with 998 more rows, and 21 more variables: month.xts &lt;int&gt;,
## #   month.lbl &lt;ord&gt;, day &lt;int&gt;, hour &lt;int&gt;, minute &lt;int&gt;, second &lt;int&gt;,
## #   hour12 &lt;int&gt;, am.pm &lt;int&gt;, wday &lt;int&gt;, wday.xts &lt;int&gt;, wday.lbl &lt;ord&gt;,
## #   mday &lt;int&gt;, qday &lt;int&gt;, yday &lt;int&gt;, mweek &lt;int&gt;, week &lt;int&gt;,
## #   week.iso &lt;int&gt;, week2 &lt;int&gt;, week3 &lt;int&gt;, week4 &lt;int&gt;, mday7 &lt;int&gt;</code></pre>
<p>Analyzing the time series is now easier with the decomposed measures. For example, we can create a month plot very easily in <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co"># Example Benefit 1: Making a month plot</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2">FB_vol_monthly &lt;-<span class="st"> </span>FB_vol_date_signature <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="st">    </span><span class="kw">group_by</span>(year, month.lbl) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">volume =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(volume)) </a>
<a class="sourceLine" id="cb20-5" data-line-number="5"></a>
<a class="sourceLine" id="cb20-6" data-line-number="6">FB_vol_monthly <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> month.lbl, <span class="dt">y =</span> volume, <span class="dt">fill =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(year))) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">"identity"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">"Month Plot of FB Volume"</span>, <span class="dt">x =</span><span class="st">""</span>, <span class="dt">fill =</span> <span class="st">"Year"</span>,</a>
<a class="sourceLine" id="cb20-10" data-line-number="10">         <span class="dt">subtitle =</span> <span class="st">"Analyzing time-based metrics is easy with time series signature"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-11" data-line-number="11"><span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/tidyquant/man/theme_tq.html">theme_tq</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb20-12" data-line-number="12"><span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">hjust =</span> <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-13" data-line-number="13"><span class="st">    </span><span class="kw"><a href="https://rdrr.io/pkg/tidyquant/man/scale_manual.html">scale_fill_tq</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb20-14" data-line-number="14"><span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>comma)</a></code></pre></div>
<p><img src="TK01_Working_With_Time_Series_Index_files/figure-html/unnamed-chunk-11-1.png" width="95%" style="display: block; margin: auto;"></p>
<p>Modeling is also much easier. As an example, we can use linear regression model using the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> function with the month and year as a predictor of volume.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co"># Example Benefit 2: Modeling is easier</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">fit &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(volume <span class="op">~</span><span class="st"> </span>year <span class="op">+</span><span class="st"> </span>month.lbl, <span class="dt">data =</span> FB_vol_monthly)</a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(fit)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = volume ~ year + month.lbl, data = FB_vol_monthly)
## 
## Residuals:
##        Min         1Q     Median         3Q        Max 
## -630168696 -241179924   -2717615  163606096  776716101 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   5.275e+11  8.527e+10   6.186 4.40e-07 ***
## year         -2.614e+08  4.233e+07  -6.176 4.53e-07 ***
## month.lbl.L  -1.492e+08  1.639e+08  -0.910    0.369    
## month.lbl.Q   1.035e+08  1.639e+08   0.632    0.532    
## month.lbl.C  -2.024e+08  1.639e+08  -1.235    0.225    
## month.lbl^4  -3.825e+07  1.639e+08  -0.233    0.817    
## month.lbl^5  -7.598e+07  1.639e+08  -0.463    0.646    
## month.lbl^6   1.280e+08  1.639e+08   0.781    0.440    
## month.lbl^7   1.356e+07  1.639e+08   0.083    0.935    
## month.lbl^8   5.948e+07  1.639e+08   0.363    0.719    
## month.lbl^9   2.479e+08  1.639e+08   1.512    0.140    
## month.lbl^10 -9.894e+07  1.639e+08  -0.604    0.550    
## month.lbl^11 -1.019e+08  1.639e+08  -0.622    0.538    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 327900000 on 35 degrees of freedom
## Multiple R-squared:  0.5622, Adjusted R-squared:  0.4121 
## F-statistic: 3.746 on 12 and 35 DF,  p-value: 0.001102</code></pre>
</div>
<div id="tk_get_timeseries_summary" class="section level2">
<h2 class="hasAnchor">
<a href="#tk_get_timeseries_summary" class="anchor"></a>tk_get_timeseries_summary</h2>
<p>The next index analysis tool is the summary metrics, which can be retrieved using the <code><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_summary()</a></code> function. The summary reports the following attributes as a single-row tibble.</p>
<p><em>General Summary</em>:</p>
<p>The first six columns are general summary information.</p>
<ul>
<li>
<strong>n.obs</strong>: The total number of observations</li>
<li>
<strong>start</strong>: The start in the appropriate time class</li>
<li>
<strong>end</strong>: The end in the appropriate time class</li>
<li>
<strong>units</strong>: A label that describes the unit of the index value that is independent of frequency (i.e. a date class will always be “days” whereas a datetime class will always be “seconds”). Values can be days, hours, mins, secs.</li>
<li>
<strong>scale</strong>: A label that describes the the median difference (frequency) between observations. Values can be quarter, month, day, hour, minute, second.</li>
<li>
<strong>tzone</strong>: The timezone of the index.</li>
</ul>
<p><em>Differences Summary</em>:</p>
<p>The next group of values are the <strong>differences summary</strong> (i.e. summary of frequency). All values are in seconds:</p>
<ul>
<li>
<strong>diff.minimum</strong>: The minimum difference between index values.</li>
<li>
<strong>diff.q1</strong>: The first quartile of the index differences.</li>
<li>
<strong>diff.median</strong>: The median difference between index values (i.e. most common frequency).</li>
<li>
<strong>diff.mean</strong>: The average difference between index values.</li>
<li>
<strong>diff.q3</strong>: The third quartile of the index differences.</li>
<li>
<strong>diff.maximum</strong>: The maximum difference between index values.</li>
</ul>
<p>The <strong>differences</strong> provide information about the <em>regularity of the frequency</em>. Generally speaking if all difference values are equal, the index is regular. However, scales beyond “day” are never theoretically regular since the differences in seconds are not equivalent. However, conceptually monthly, quarterly and yearly data can be thought of as regular if the index contains consecutive months, quarters, or years, respectively. Therefore, the difference attributes are most meaningful for daily and lower time scales because the difference summary always indicates level of regularity.</p>
<p>We can get the time series summary using <code><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_summary()</a></code>. We’ll split the output into six columns to view in the vignette. From the first group summary (general summary), we recognize that there are 1008 observations that span 2013 through 2016. The “units” of each index value are in “days”, and the “scale” of the index values is “day” for daily periodicity.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="co"># idx_date: First six columns, general summary</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="kw"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_summary</a></span>(idx_date)[,<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>]</a></code></pre></div>
<pre><code>## # A tibble: 1 x 6
##   n.obs start      end        units scale tzone
##   &lt;int&gt; &lt;date&gt;     &lt;date&gt;     &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1  1008 2013-01-02 2016-12-30 days  day   UTC</code></pre>
<p>From the second group (differences summary), we immediately recognize that the mean is different than the median and therefore the index is <em>irregular</em> (meaning certain days are missing). Further we can see that the maximum difference is 345,600 seconds, indicating the maximum difference is 4 days (345,600 seconds / 86400 seconds/day).</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="co"># idx_date: Last six columns, difference summary</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="kw"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_summary</a></span>(idx_date)[,<span class="dv">7</span><span class="op">:</span><span class="dv">12</span>]</a></code></pre></div>
<pre><code>## # A tibble: 1 x 6
##   diff.minimum diff.q1 diff.median diff.mean diff.q3 diff.maximum
##          &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;
## 1        86400   86400       86400   125096.   86400       345600</code></pre>
<p>We can also get the summary from the quarterly data using <code><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_summary()</a></code>. The general summary for the quarterly output may not be what is expected because the “units” are reported as “days”. This is because the maximum unit for an index value is days regardless of timeseries class. As anticipated the scale is “quarterly”.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="co"># idx_yearqtr: First six columns, general summary</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="kw"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_summary</a></span>(idx_yearqtr)[,<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>]</a></code></pre></div>
<pre><code>## # A tibble: 1 x 6
##   n.obs start     end       units scale   tzone
##   &lt;int&gt; &lt;yearqtr&gt; &lt;yearqtr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;
## 1    16 2013 Q1   2016 Q4   days  quarter UTC</code></pre>
<p>The difference summary indicates that the timeseries is <em>irregular</em>, which also may not be what is expected. This is because, when measured in seconds, the difference values between observations (quarters) varies. Some quarters have more seconds than others. With this said, the quarterly data can be conceptualized as <em>regular</em> because the class is quarterly with all consecutive quarters present in the timespan.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="co"># idx_yearqtr: Last six columns, difference summary</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="kw"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_summary</a></span>(idx_yearqtr)[,<span class="dv">7</span><span class="op">:</span><span class="dv">12</span>]</a></code></pre></div>
<pre><code>## # A tibble: 1 x 6
##   diff.minimum diff.q1 diff.median diff.mean diff.q3 diff.maximum
##          &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;
## 1      7776000 7862400     7862400   7885440 7948800      7948800</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#prerequisites">Prerequisites</a></li>
      <li><a href="#data">Data</a></li>
      <li>
<a href="#extract-an-index">Extract an index</a><ul class="nav nav-pills nav-stacked">
<li><a href="#tk_index">tk_index</a></li>
      </ul>
</li>
      <li>
<a href="#analyze-the-index">Analyze the index</a><ul class="nav nav-pills nav-stacked">
<li><a href="#tk_get_timeseries_signature-and-tk_augment_timeseries_signature">tk_get_timeseries_signature and tk_augment_timeseries_signature</a></li>
      <li><a href="#tk_get_timeseries_summary">tk_get_timeseries_summary</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Matt Dancho, Davis Vaughan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
