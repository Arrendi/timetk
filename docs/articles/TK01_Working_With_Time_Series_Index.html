<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with the Time Series Index using timekit • timekit</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">timekit</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Function Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/TK00_Time_Series_Coercion.html">Time series coercion</a>
    </li>
    <li>
      <a href="../articles/TK01_Working_With_Time_Series_Index.html">Time series index</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/business-science/timekit">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Working with the Time Series Index using timekit</h1>
                        <h4 class="author">Matt Dancho</h4>
            
            <h4 class="date">2017-05-01</h4>
          </div>

    
    
<div class="contents">
<blockquote>
<p>A collection of tools for working with time series in R</p>
</blockquote>
<p>The <strong>time series index</strong>, which consists of a collection of time-based values that define <em>when</em> each observation occurred, is the most important part of a time series object. The index gives the user a lot of information in a simple timestamp. Consider the datetime “2016-01-01 00:00:00”. From this timestamp, we can decompose the datetime to get the <strong>signature</strong>, which consists of the year, quarter, month, day, day of year, day of month, hour, minute, and second of the occurrence of a single observation. Further, the difference between two or more observations is the <strong>frequency</strong> from which we can obtain even more information such as the periodicity of the data and whether or not these observations are on a regular interval. This information is critical as it provides the basis for performance over time in finance, decay rates in biology, growth rates in economics, and so on.</p>
<p>In this vignette the user will be exposed to the time series index, tools to gain insights and work with it, and methods to work with time series data in general. The user will see several functions that can help to efficiently extract and analyze a time series index. Further, the user will see how to decompose an index (i.e. create a signature) and how to efficiently add the signature to a time series object (<code>tbl</code> with time basis, <code>xts</code> or <code>zoo</code> objects). In addition, the user will learn about summary metrics and how to compute future time index values based on an existing index.</p>
<div id="prerequisites" class="section level1">
<h1 class="hasAnchor">
<a href="#prerequisites" class="anchor"></a>Prerequisites</h1>
<p>Before we get started, load the following packages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyquant)
<span class="kw">library</span>(timekit)</code></pre></div>
</div>
<div id="data" class="section level1">
<h1 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h1>
<p>We’ll use the Facebook stock prices from the <code>FANG</code> data set from <code>tidyquant</code>. These are the historical stock prices (open, high, low, close, volume, and adjusted) for the “FB” stock from 2013 through 2016.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FB_tbl &lt;-<span class="st"> </span>FANG %&gt;%<span class="st"> </span><span class="kw">filter</span>(symbol ==<span class="st"> "FB"</span>)
FB_tbl</code></pre></div>
<pre><code>## # A tibble: 1,008 × 8
##    symbol       date  open  high   low close    volume adjusted
##     &lt;chr&gt;     &lt;date&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1      FB 2013-01-02 27.44 28.18 27.42 28.00  69846400    28.00
## 2      FB 2013-01-03 27.88 28.47 27.59 27.77  63140600    27.77
## 3      FB 2013-01-04 28.01 28.93 27.83 28.76  72715400    28.76
## 4      FB 2013-01-07 28.69 29.79 28.65 29.42  83781800    29.42
## 5      FB 2013-01-08 29.51 29.60 28.86 29.06  45871300    29.06
## 6      FB 2013-01-09 29.67 30.60 29.49 30.59 104787700    30.59
## 7      FB 2013-01-10 30.60 31.45 30.28 31.30  95316400    31.30
## 8      FB 2013-01-11 31.28 31.96 31.10 31.72  89598000    31.72
## 9      FB 2013-01-14 32.08 32.21 30.62 30.95  98892800    30.95
## 10     FB 2013-01-15 30.64 31.71 29.88 30.10 173242600    30.10
## # ... with 998 more rows</code></pre>
<p>To simplify the tutorial, we will select only the “date” and “volume” columns. For the <code>FB_vol_date</code> data frame, we can see from the “date” column that the observations are <em>daily</em> beginning on the second day of 2013.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FB_vol_date &lt;-<span class="st"> </span>FB_tbl %&gt;%<span class="st"> </span><span class="kw">select</span>(date, volume)
FB_vol_date</code></pre></div>
<pre><code>## # A tibble: 1,008 × 2
##          date    volume
##        &lt;date&gt;     &lt;dbl&gt;
## 1  2013-01-02  69846400
## 2  2013-01-03  63140600
## 3  2013-01-04  72715400
## 4  2013-01-07  83781800
## 5  2013-01-08  45871300
## 6  2013-01-09 104787700
## 7  2013-01-10  95316400
## 8  2013-01-11  89598000
## 9  2013-01-14  98892800
## 10 2013-01-15 173242600
## # ... with 998 more rows</code></pre>
<p>To show examples using alternative time series classes, we’ll summarize the data as <code>yearqtr</code> from the <code>zoo</code> package. We now see from the “date” column that the observations are <em>quarterly</em> beginning on the first quarter of 2013.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FB_vol_yearqtr &lt;-<span class="st"> </span>FB_vol_date %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">as.yearqtr</span>(date)) %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(date) %&gt;%
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">volume =</span> <span class="kw">sum</span>(volume))
FB_vol_yearqtr</code></pre></div>
<pre><code>## # A tibble: 16 × 2
##             date     volume
##    &lt;S3: yearqtr&gt;      &lt;dbl&gt;
## 1        2013 Q1 3360672000
## 2        2013 Q2 2508935500
## 3        2013 Q3 4366095000
## 4        2013 Q4 4907480100
## 5        2014 Q1 3660928900
## 6        2014 Q2 3867510400
## 7        2014 Q3 2340124400
## 8        2014 Q4 2109135400
## 9        2015 Q1 1596531700
## 10       2015 Q2 1501555300
## 11       2015 Q3 2135807400
## 12       2015 Q4 1558813800
## 13       2016 Q1 2188123300
## 14       2016 Q2 1652751000
## 15       2016 Q3 1212297600
## 16       2016 Q4 1361185100</code></pre>
</div>
<div id="extract-an-index" class="section level1">
<h1 class="hasAnchor">
<a href="#extract-an-index" class="anchor"></a>Extract an index</h1>
<div id="tk_index" class="section level2">
<h2 class="hasAnchor">
<a href="#tk_index" class="anchor"></a>tk_index</h2>
<p>Before we can analyze an index, we need to extract it from the object. The function <code><a href="../reference/tk_index.html">tk_index()</a></code> extracts the index from any time series object including data frame (or <code>tbl</code>), <code>xts</code>, <code>zoo</code>, etc. The index is always returned in the native date, datetime, yearmon, or yearqtr format. Note that the index must be in one of these time-based classes for extraction to work:</p>
<ul>
<li>datetimes: Must inherit <code>POSIXt</code>
</li>
<li>dates: Must inherit <code>Date</code>
</li>
<li>yearmon: Must inherit <code>yearmon</code> from the <code>zoo</code> package</li>
<li>yearqtr: Must inherit <code>yearqtr</code> from the <code>zoo</code> package</li>
</ul>
<p>Extract the index using <code><a href="../reference/tk_index.html">tk_index()</a></code>. The structure is shown to see the output format, which is a vector of dates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># idx_date</span>
idx_date &lt;-<span class="st"> </span><span class="kw"><a href="../reference/tk_index.html">tk_index</a></span>(FB_vol_date)
<span class="kw">str</span>(idx_date)</code></pre></div>
<pre><code>##  Date[1:1008], format: "2013-01-02" "2013-01-03" "2013-01-04" "2013-01-07" "2013-01-08" ...</code></pre>
<p>We can see a similar result with the yearqtr index. The obvious differences are fewer observations since the time series was aggregated quarterly and the output format is the <code>yearqtr</code> class.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># idx_yearqtr</span>
idx_yearqtr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/tk_index.html">tk_index</a></span>(FB_vol_yearqtr)
<span class="kw">paste0</span>(<span class="st">"class: "</span>, <span class="kw">class</span>(idx_yearqtr), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>,
       <span class="st">"n.obs: "</span>, <span class="kw">length</span>(idx_yearqtr), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>,
       <span class="st">"head:  "</span>, stringr::<span class="kw">str_c</span>(<span class="kw">head</span>(idx_yearqtr), <span class="dt">collapse =</span> <span class="st">", "</span>)) %&gt;%
<span class="st">    </span><span class="kw">cat</span>()</code></pre></div>
<pre><code>## class: yearqtr
## n.obs: 16
## head:  2013 Q1, 2013 Q2, 2013 Q3, 2013 Q4, 2014 Q1, 2014 Q2</code></pre>
</div>
</div>
<div id="analyze-the-index" class="section level1">
<h1 class="hasAnchor">
<a href="#analyze-the-index" class="anchor"></a>Analyze the index</h1>
<div id="tk_get_timeseries_signature-and-tk_augment_timeseries_signature" class="section level2">
<h2 class="hasAnchor">
<a href="#tk_get_timeseries_signature-and-tk_augment_timeseries_signature" class="anchor"></a>tk_get_timeseries_signature and tk_augment_timeseries_signature</h2>
<p>The index can be decomposed into a <em>signature</em>. The time series signature is a unique set of properties of the time series values that describe the time series. The function <code><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_signature()</a></code> can be used to convert the index to a tibble containing the following values (columns):</p>
<ul>
<li>
<strong>index</strong>: The index value that was decomposed</li>
<li>
<strong>index.num</strong>: The numeric value of the index in seconds. The base is “1970-01-01 00:00:00” (Execute <code>"1970-01-01 00:00:00" %&gt;% ymd_hms() %&gt;% as.numeric()</code> to see the value returned is zero). Every time series value after this date can be converted to a numeric value in seconds.</li>
<li>
<strong>diff</strong>: The difference in seconds from the previous numeric index value.</li>
<li>
<strong>year</strong>: The year component of the index.</li>
<li>
<strong>half</strong>: The half component of the index.</li>
<li>
<strong>quarter</strong>: The quarter component of the index.</li>
<li>
<strong>month</strong>: The month component of the index with base 1.</li>
<li>
<strong>month.xts</strong>: The month component of the index with base 0, which is what <code>xts</code> implements.</li>
<li>
<strong>month.lbl</strong>: The month label as an ordered factor begining with January and ending with December.</li>
<li>
<strong>day</strong>: The day component of the index.</li>
<li>
<strong>hour</strong>: The hour component of the index.</li>
<li>
<strong>minute</strong>: The minute component of the index.</li>
<li>
<strong>second</strong>: The second component of the index.</li>
<li>
<strong>wday</strong>: The day of the week with base 1. Sunday = 1 and Saturday = 7.</li>
<li>
<strong>wday.xts</strong>: The day of the week with base 0, which is what <code>xts</code> implements. Sunday = 0 and Saturday = 6.</li>
<li>
<strong>wday.lbl</strong>: The day of the week label as an ordered factor begining with Sunday and ending with Saturday.</li>
<li>
<strong>mday</strong>: The day of the month.</li>
<li>
<strong>yday</strong>: The day of the year.</li>
<li>
<strong>week</strong>: The week number of the year (Sunday start).</li>
<li>
<strong>week.iso</strong>: The ISO week number of the year (Monday start).</li>
<li>
<strong>week2</strong>: The modulus for bi-weekly frequency.</li>
<li>
<strong>week3</strong>: The modulus for tri-weekly frequency.</li>
<li>
<strong>week4</strong>: The modulus for quad-weekly frequency.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># idx_date signature</span>
<span class="kw"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_signature</a></span>(idx_date)</code></pre></div>
<pre><code>## # A tibble: 1,008 × 23
##         index  index.num   diff  year  half quarter month month.xts
##        &lt;date&gt;      &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;     &lt;int&gt;
## 1  2013-01-02 1357084800     NA  2013     1       1     1         0
## 2  2013-01-03 1357171200  86400  2013     1       1     1         0
## 3  2013-01-04 1357257600  86400  2013     1       1     1         0
## 4  2013-01-07 1357516800 259200  2013     1       1     1         0
## 5  2013-01-08 1357603200  86400  2013     1       1     1         0
## 6  2013-01-09 1357689600  86400  2013     1       1     1         0
## 7  2013-01-10 1357776000  86400  2013     1       1     1         0
## 8  2013-01-11 1357862400  86400  2013     1       1     1         0
## 9  2013-01-14 1358121600 259200  2013     1       1     1         0
## 10 2013-01-15 1358208000  86400  2013     1       1     1         0
## # ... with 998 more rows, and 15 more variables: month.lbl &lt;ord&gt;,
## #   day &lt;int&gt;, hour &lt;int&gt;, minute &lt;int&gt;, second &lt;int&gt;, wday &lt;int&gt;,
## #   wday.xts &lt;int&gt;, wday.lbl &lt;ord&gt;, mday &lt;int&gt;, yday &lt;int&gt;, week &lt;int&gt;,
## #   week.iso &lt;int&gt;, week2 &lt;int&gt;, week3 &lt;int&gt;, week4 &lt;int&gt;</code></pre>
<p>We can also get the signature of other time-based objects. The <code><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_signature()</a></code> function works with date, datetime, yearmon, and yearqtr vectors.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># idx_yearqtr signature</span>
<span class="kw"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_signature</a></span>(idx_yearqtr)</code></pre></div>
<pre><code>## # A tibble: 16 × 23
##            index  index.num    diff  year  half quarter month month.xts
##    &lt;S3: yearqtr&gt;      &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;     &lt;int&gt;
## 1        2013 Q1 1356998400      NA  2013     1       1     1         0
## 2        2013 Q2 1364774400 7776000  2013     1       2     4         3
## 3        2013 Q3 1372636800 7862400  2013     2       3     7         6
## 4        2013 Q4 1380585600 7948800  2013     2       4    10         9
## 5        2014 Q1 1388534400 7948800  2014     1       1     1         0
## 6        2014 Q2 1396310400 7776000  2014     1       2     4         3
## 7        2014 Q3 1404172800 7862400  2014     2       3     7         6
## 8        2014 Q4 1412121600 7948800  2014     2       4    10         9
## 9        2015 Q1 1420070400 7948800  2015     1       1     1         0
## 10       2015 Q2 1427846400 7776000  2015     1       2     4         3
## 11       2015 Q3 1435708800 7862400  2015     2       3     7         6
## 12       2015 Q4 1443657600 7948800  2015     2       4    10         9
## 13       2016 Q1 1451606400 7948800  2016     1       1     1         0
## 14       2016 Q2 1459468800 7862400  2016     1       2     4         3
## 15       2016 Q3 1467331200 7862400  2016     2       3     7         6
## 16       2016 Q4 1475280000 7948800  2016     2       4    10         9
## # ... with 15 more variables: month.lbl &lt;ord&gt;, day &lt;int&gt;, hour &lt;int&gt;,
## #   minute &lt;int&gt;, second &lt;int&gt;, wday &lt;int&gt;, wday.xts &lt;int&gt;,
## #   wday.lbl &lt;ord&gt;, mday &lt;int&gt;, yday &lt;int&gt;, week &lt;int&gt;, week.iso &lt;int&gt;,
## #   week2 &lt;int&gt;, week3 &lt;int&gt;, week4 &lt;int&gt;</code></pre>
<p>It’s usually important to keep the index signature with the values (e.g. volume in our example). We can use an expedited approach with <code><a href="../reference/tk_augment_timeseries.html">tk_augment_timeseries_signature()</a></code>, which adds the signature to the end of the time series object. Note that <code>xts</code> and <code>zoo</code> objects only retain numeric columns and therefore “month.lbl” and “wday.lbl” columns will be dropped. We’ll use the <code><a href="../reference/tk_augment_timeseries.html">tk_augment_timeseries_signature()</a></code> function on the dataframe <code>FB_vol_date</code> which contains the date and volume columns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Augmenting a data frame</span>
FB_vol_date_signature &lt;-<span class="st"> </span><span class="kw"><a href="../reference/tk_augment_timeseries.html">tk_augment_timeseries_signature</a></span>(FB_vol_date)
FB_vol_date_signature</code></pre></div>
<pre><code>## # A tibble: 1,008 × 24
##          date    volume  index.num   diff  year  half quarter month
##        &lt;date&gt;     &lt;dbl&gt;      &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;
## 1  2013-01-02  69846400 1357084800     NA  2013     1       1     1
## 2  2013-01-03  63140600 1357171200  86400  2013     1       1     1
## 3  2013-01-04  72715400 1357257600  86400  2013     1       1     1
## 4  2013-01-07  83781800 1357516800 259200  2013     1       1     1
## 5  2013-01-08  45871300 1357603200  86400  2013     1       1     1
## 6  2013-01-09 104787700 1357689600  86400  2013     1       1     1
## 7  2013-01-10  95316400 1357776000  86400  2013     1       1     1
## 8  2013-01-11  89598000 1357862400  86400  2013     1       1     1
## 9  2013-01-14  98892800 1358121600 259200  2013     1       1     1
## 10 2013-01-15 173242600 1358208000  86400  2013     1       1     1
## # ... with 998 more rows, and 16 more variables: month.xts &lt;int&gt;,
## #   month.lbl &lt;ord&gt;, day &lt;int&gt;, hour &lt;int&gt;, minute &lt;int&gt;, second &lt;int&gt;,
## #   wday &lt;int&gt;, wday.xts &lt;int&gt;, wday.lbl &lt;ord&gt;, mday &lt;int&gt;, yday &lt;int&gt;,
## #   week &lt;int&gt;, week.iso &lt;int&gt;, week2 &lt;int&gt;, week3 &lt;int&gt;, week4 &lt;int&gt;</code></pre>
<p>Analyzing the time series is now easier with the decomposed measures. For example, we can create a month plot very easily in <code>ggplot2</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Example Benefit 1: Making a month plot</span>
FB_vol_monthly &lt;-<span class="st"> </span>FB_vol_date_signature %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(year, month.lbl) %&gt;%
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">volume =</span> <span class="kw">sum</span>(volume)) 

FB_vol_monthly %&gt;%
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> month.lbl, <span class="dt">y =</span> volume, <span class="dt">fill =</span> <span class="kw">factor</span>(year))) +
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">"identity"</span>) +
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">"Month Plot of FB Volume"</span>, <span class="dt">x =</span><span class="st">""</span>, <span class="dt">fill =</span> <span class="st">"Year"</span>,
         <span class="dt">subtitle =</span> <span class="st">"Analyzing time-based metrics is easy with time series signature"</span>) +
<span class="st">    </span><span class="kw">theme_tq</span>() +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">hjust =</span> <span class="dv">1</span>)) +
<span class="st">    </span><span class="kw">scale_fill_tq</span>() +
<span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales::comma)</code></pre></div>
<p><img src="TK01_Working_With_Time_Series_Index_files/figure-html/unnamed-chunk-11-1.png" width="95%" style="display: block; margin: auto;"></p>
<p>Modeling is also much easier. As an example, we can use linear regression model using the <code>lm()</code> function with the month and year as a predictor of volume.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Example Benefit 2: Modeling is easier</span>
fit &lt;-<span class="st"> </span><span class="kw">lm</span>(volume ~<span class="st"> </span>year +<span class="st"> </span>month.lbl, <span class="dt">data =</span> FB_vol_monthly)
<span class="kw">summary</span>(fit)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = volume ~ year + month.lbl, data = FB_vol_monthly)
## 
## Residuals:
##        Min         1Q     Median         3Q        Max 
## -630168696 -241179924   -2717615  163606096  776716101 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   5.275e+11  8.527e+10   6.186 4.40e-07 ***
## year         -2.614e+08  4.233e+07  -6.176 4.53e-07 ***
## month.lbl.L  -1.492e+08  1.639e+08  -0.910    0.369    
## month.lbl.Q   1.035e+08  1.639e+08   0.632    0.532    
## month.lbl.C  -2.024e+08  1.639e+08  -1.235    0.225    
## month.lbl^4  -3.825e+07  1.639e+08  -0.233    0.817    
## month.lbl^5  -7.598e+07  1.639e+08  -0.463    0.646    
## month.lbl^6   1.280e+08  1.639e+08   0.781    0.440    
## month.lbl^7   1.356e+07  1.639e+08   0.083    0.935    
## month.lbl^8   5.948e+07  1.639e+08   0.363    0.719    
## month.lbl^9   2.479e+08  1.639e+08   1.512    0.140    
## month.lbl^10 -9.894e+07  1.639e+08  -0.604    0.550    
## month.lbl^11 -1.019e+08  1.639e+08  -0.622    0.538    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 327900000 on 35 degrees of freedom
## Multiple R-squared:  0.5622, Adjusted R-squared:  0.4121 
## F-statistic: 3.746 on 12 and 35 DF,  p-value: 0.001102</code></pre>
</div>
<div id="tk_get_timeseries_summary" class="section level2">
<h2 class="hasAnchor">
<a href="#tk_get_timeseries_summary" class="anchor"></a>tk_get_timeseries_summary</h2>
<p>The next index analysis tool is the summary metrics, which can be retrieved using the <code><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_summary()</a></code> function. The summary reports the following attributes as a single-row tibble.</p>
<p><em>General Summary</em>:</p>
<p>The first six columns are general summary information.</p>
<ul>
<li>
<strong>n.obs</strong>: The total number of observations</li>
<li>
<strong>start</strong>: The start in the appropriate time class</li>
<li>
<strong>end</strong>: The end in the appropriate time class</li>
<li>
<strong>units</strong>: A label that describes the unit of the index value that is independent of frequency (i.e. a date class will always be “days” whereas a datetime class will always be “seconds”). Values can be days, hours, mins, secs.</li>
<li>
<strong>scale</strong>: A label that describes the the median difference (frequency) between observations. Values can be quarter, month, day, hour, minute, second.</li>
<li>
<strong>tzone</strong>: The timezone of the index.</li>
</ul>
<p><em>Differences Summary</em>:</p>
<p>The next group of values are the <strong>differences summary</strong> (i.e. summary of frequency). All values are in seconds:</p>
<ul>
<li>
<strong>diff.minimum</strong>: The minimum difference between index values.</li>
<li>
<strong>diff.q1</strong>: The first quartile of the index differences.</li>
<li>
<strong>diff.median</strong>: The median difference between index values (i.e. most common frequency).</li>
<li>
<strong>diff.mean</strong>: The average difference between index values.</li>
<li>
<strong>diff.q3</strong>: The third quartile of the index differences.</li>
<li>
<strong>diff.maximum</strong>: The maximum difference between index values.</li>
</ul>
<p>The <strong>differences</strong> provide information about the <em>regularity of the frequency</em>. Generally speaking if all difference values are equal, the index is regular. However, scales beyond “day” are never theoretically regular since the differences in seconds are not equivalent. However, conceptually monthly, quarterly and yearly data can be thought of as regular if the index contains consecutive months, quarters, or years, respectively. Therefore, the difference attributes are most meaningful for daily and lower time scales because the difference summary always indicates level of regularity.</p>
<p>We can get the time series summary using <code><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_summary()</a></code>. We’ll split the output into six columns to view in the vignette. From the first group summary (general summary), we recognize that there are 1008 observations that span 2013 through 2016. The “units” of each index value are in “days”, and the “scale” of the index values is “day” for daily periodicity.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># idx_date: First six columns, general summary</span>
<span class="kw"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_summary</a></span>(idx_date)[,<span class="dv">1</span>:<span class="dv">6</span>]</code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   n.obs      start        end units scale tzone
##   &lt;int&gt;     &lt;date&gt;     &lt;date&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1  1008 2013-01-02 2016-12-30  days   day   UTC</code></pre>
<p>From the second group (differences summary), we immediately recognize that the mean is different than the median and therefore the index is <em>irregular</em> (meaning certain days are missing). Further we can see that the maximum difference is 345,600 seconds, indicating the maximum difference is 4 days (345,600 seconds / 86400 seconds/day).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># idx_date: Last six columns, difference summary</span>
<span class="kw"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_summary</a></span>(idx_date)[,<span class="dv">7</span>:<span class="dv">12</span>]</code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   diff.minimum diff.q1 diff.median diff.mean diff.q3 diff.maximum
##          &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;
## 1        86400   86400       86400  125095.5   86400       345600</code></pre>
<p>We can also get the summary from the quarterly data using <code><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_summary()</a></code>. The general summary for the quarterly output may not be what is expected because the “units” are reported as “days”. This is because the maximum unit for an index value is days regardless of timeseries class. As anticipated the scale is “quarterly”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># idx_yearqtr: First six columns, general summary</span>
<span class="kw"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_summary</a></span>(idx_yearqtr)[,<span class="dv">1</span>:<span class="dv">6</span>]</code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   n.obs         start           end units   scale tzone
##   &lt;int&gt; &lt;S3: yearqtr&gt; &lt;S3: yearqtr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;
## 1    16       2013 Q1       2016 Q4  days quarter   UTC</code></pre>
<p>The difference summary indicates that the timeseries is <em>irregular</em>, which also may not be what is expected. This is because, when measured in seconds, the difference values between observations (quarters) varies. Some quarters have more seconds than others. With this said, the quarterly data can be conceptualized as <em>regular</em> because the class is quarterly with all consecutive quarters present in the timespan.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># idx_yearqtr: Last six columns, difference summary</span>
<span class="kw"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_summary</a></span>(idx_yearqtr)[,<span class="dv">7</span>:<span class="dv">12</span>]</code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   diff.minimum diff.q1 diff.median diff.mean diff.q3 diff.maximum
##          &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;
## 1      7776000 7862400     7862400   7885440 7948800      7948800</code></pre>
</div>
</div>
<div id="make-a-future-index" class="section level1">
<h1 class="hasAnchor">
<a href="#make-a-future-index" class="anchor"></a>Make a future index</h1>
<div id="tk_make_future_index" class="section level2">
<h2 class="hasAnchor">
<a href="#tk_make_future_index" class="anchor"></a>tk_make_future_index</h2>
<p>Sometimes we want to extend an index into the future. This task can be tricky because in addition to a frequency that needs to be accounted for there’s often missing dates (e.g. weekends and holidays for daily data). The <code>tk_make_future_index()</code> simplifies this task by incoporating:</p>
<ol style="list-style-type: decimal">
<li>The frequency regardless of scale</li>
<li>Daily scale only: The weekday frequency on weekly, bi-weekly, tri-weekly, and quad-weekly frequency. This can be toggled on/off with the boolean <code>inspect_weekdays</code> argument.</li>
</ol>
<p>Further, missing observations on irregular intervals (e.g. holidays) can be another issue for daily data. These skipped days can be explicitly excluded from the future index using the <code>skip_values</code> argument. Note that the class of these values must match the class of the index.</p>
<p>Here’s an example of using an index to create a future index. We’ll use <code>idx_date</code> first to show how the output varies with the arguments. The <code>n_future</code> argument tells the function how many future index values to make. The first 20 observations are shown for brevity. We can see that the output is a series of daily dates that extend from the last day present in the previous index (“2016-12-30”). While the result got the frequency correct (daily) it isn’t realistic for our data because weekends are present and so are holidays (e.g. new year’s day).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># idx_date: future index, no weekday inspection, no skip values</span>
<span class="kw"><a href="../reference/tk_make_future_timeseries.html">tk_make_future_timeseries</a></span>(idx_date, 
                          <span class="dt">n_future =</span> <span class="dv">20</span>, 
                          <span class="dt">skip_values =</span> <span class="ot">NULL</span>, 
                          <span class="dt">inspect_weekdays =</span> <span class="ot">FALSE</span>
                          )</code></pre></div>
<pre><code>##  [1] "2016-12-31" "2017-01-01" "2017-01-02" "2017-01-03" "2017-01-04"
##  [6] "2017-01-05" "2017-01-06" "2017-01-07" "2017-01-08" "2017-01-09"
## [11] "2017-01-10" "2017-01-11" "2017-01-12" "2017-01-13" "2017-01-14"
## [16] "2017-01-15" "2017-01-16" "2017-01-17" "2017-01-18" "2017-01-19"</code></pre>
<p>We can correct for this using the <code>skip_values</code> and <code>inspect_weekdays</code> arguments. The former removes specific observations while the latter uses a logistic regression algorithm to identify the probability of specific weekdays being present in the future index. The algorithm for inspecting weekdays will check for any weekdays that are missing on a weekly, bi-weekly, tri-weekly, or quad-weekly frequency and automatically remove these days. As shown below, holidays (New Year’s Day and Martin Luther King, Jr. Day) and weekends are accounted for.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># idx_date: future index, accounting for holidays and weekends</span>
<span class="co"># Build vector of holidays in correct timeseries class using ymd()</span>
holidays &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"2017-01-02"</span>, <span class="st">"2017-01-16"</span>) %&gt;%<span class="st"> </span><span class="kw">ymd</span>()
<span class="co"># Create future index</span>
<span class="kw"><a href="../reference/tk_make_future_timeseries.html">tk_make_future_timeseries</a></span>(idx_date, 
                          <span class="dt">n_future =</span> <span class="dv">20</span>, 
                          <span class="dt">skip_values =</span> holidays, 
                          <span class="dt">inspect_weekdays =</span> <span class="ot">TRUE</span>
                          )</code></pre></div>
<pre><code>##  [1] "2017-01-03" "2017-01-04" "2017-01-05" "2017-01-06" "2017-01-09"
##  [6] "2017-01-10" "2017-01-11" "2017-01-12" "2017-01-13" "2017-01-17"
## [11] "2017-01-18" "2017-01-19" "2017-01-20" "2017-01-23" "2017-01-24"
## [16] "2017-01-25" "2017-01-26" "2017-01-27" "2017-01-30" "2017-01-31"</code></pre>
<p>We can also project the year quarter index into the future. Note that the <code>inspect_weekdays</code> argument has no effect on an index with a non-daily scale.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># idx_yearqtr: </span>
<span class="kw"><a href="../reference/tk_make_future_timeseries.html">tk_make_future_timeseries</a></span>(idx_yearqtr, <span class="dt">n_future =</span> <span class="dv">4</span>)</code></pre></div>
<pre><code>## [1] "2017 Q1" "2017 Q2" "2017 Q3" "2017 Q4"</code></pre>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#prerequisites">Prerequisites</a></li>
      <li><a href="#data">Data</a></li>
      <li>
<a href="#extract-an-index">Extract an index</a><ul class="nav nav-pills nav-stacked">
<li><a href="#tk_index">tk_index</a></li>
      </ul>
</li>
      <li>
<a href="#analyze-the-index">Analyze the index</a><ul class="nav nav-pills nav-stacked">
<li><a href="#tk_get_timeseries_signature-and-tk_augment_timeseries_signature">tk_get_timeseries_signature and tk_augment_timeseries_signature</a></li>
      <li><a href="#tk_get_timeseries_summary">tk_get_timeseries_summary</a></li>
      </ul>
</li>
      <li>
<a href="#make-a-future-index">Make a future index</a><ul class="nav nav-pills nav-stacked">
<li><a href="#tk_make_future_index">tk_make_future_index</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Matt Dancho, Davis Vaughan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
