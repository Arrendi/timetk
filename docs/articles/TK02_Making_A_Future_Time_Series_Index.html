<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Making a Future Time Series Index using timetk • timetk</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Making a Future Time Series Index using timetk">
<meta property="og:description" content="timetk">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-76139189-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-76139189-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">timetk</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/TK03_Forecasting_Using_Time_Series_Signature.html">Time Series Machine Learning</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Plotting</li>
    <li class="divider">
    <li class="dropdown-header">Time Series Helpers</li>
    <li>
      <a href="../articles/TK00_Time_Series_Coercion.html">Time series conversion</a>
    </li>
    <li>
      <a href="../articles/TK01_Working_With_Time_Series_Index.html">Time series index</a>
    </li>
    <li>
      <a href="../articles/TK02_Making_A_Future_Time_Series_Index.html">Creating future time series indices</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Function Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/business-science/timetk">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Making a Future Time Series Index using timetk</h1>
                        <h4 class="author">Matt Dancho</h4>
            
            <h4 class="date">2020-04-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/business-science/timetk/blob/master/vignettes/TK02_Making_A_Future_Time_Series_Index.Rmd"><code>vignettes/TK02_Making_A_Future_Time_Series_Index.Rmd</code></a></small>
      <div class="hidden name"><code>TK02_Making_A_Future_Time_Series_Index.Rmd</code></div>

    </div>

    
    
<blockquote>
<p>A collection of tools for working with time series in R</p>
</blockquote>
<p>A common task in forecasting is generating a future date sequence that mimics the existing index. This task can be incredibly important to the validity of the model. In this vignette the user will learn several methods to generate a future time series index from an existing index using the <code><a href="../reference/tk_make_timeseries.html">tk_make_future_timeseries()</a></code> function along with pros and cons of each and testing for accuracy. We’ll focus on making future dates with a daily frequency, which tends to be the most difficult to generate due to holidays, seasonality, weekends, etc. We’ll use two cases to illustrate the pros and cons:</p>
<ul>
<li>A simple example case with weekends and the last two weeks of the year missing</li>
<li>A example case using daily trade data for FB from 2013 through 2016</li>
</ul>
<div id="prerequisites" class="section level1">
<h1 class="hasAnchor">
<a href="#prerequisites" class="anchor"></a>Prerequisites</h1>
<p>Before we get started, load the following packages.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyquant</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">timetk</span>)</pre></body></html></div>
</div>
<div id="example-1-remove-weekends-and-last-two-weeks-of-year" class="section level1">
<h1 class="hasAnchor">
<a href="#example-1-remove-weekends-and-last-two-weeks-of-year" class="anchor"></a>Example 1: Remove Weekends and Last Two Weeks of Year</h1>
<p>This is a simulated example that shows how to use the <code><a href="../reference/tk_make_timeseries.html">tk_make_future_timeseries()</a></code> function. We’ll create a sequence of dates beginning in 2010, and extending through the first two weeks of 2013. The sequence is daily periodicity. We’ll split into training and test sets. The train set will be used to predict the future dates. The test set will be used for comparison.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># Create sequence with omitted weekends and omitted last two weeks of each year</span>
<span class="no">idx</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span>(<span class="fu">ymd</span>(<span class="st">"2010-01-01"</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="st">"day"</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">1110</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_signature</a></span>() <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!(<span class="no">wday.lbl</span>) <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Saturday"</span>, <span class="st">"Sunday"</span>)) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(!(<span class="no">week</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">51</span>, <span class="fl">52</span>, <span class="fl">53</span>))) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/tk_index.html">tk_index</a></span>()

<span class="no">idx_train</span> <span class="kw">&lt;-</span> <span class="no">idx</span>[<span class="fl">1</span>:<span class="fl">500</span>]
<span class="no">idx_test</span>  <span class="kw">&lt;-</span> <span class="no">idx</span>[<span class="fl">501</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">idx</span>)]</pre></body></html></div>
<p>First we visualize the frequency of the simulated test index, which is what we will generate as a future time series. The <code><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_signature()</a></code> function retrieves the differences (frequency or “diff” column) of the test dataset. We can then plot using <code>ggplot()</code>. The frequency (diff) is in seconds. Since it’s daily periodicity, the base 86,400 seconds. Each small spike to 253,800 seconds is a weekend, and the large spike to 1,555,200 seconds is the missing two week period at the end of the year.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">idx_test</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_signature</a></span>() <span class="kw">%&gt;%</span>
    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">index</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">diff</span>)) +
    <span class="fu">geom_line</span>(<span class="kw">color</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/palette_tq.html">palette_light</a></span>()<span class="kw">[[</span><span class="fl">1</span>]]) +
    <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/theme_tq.html">theme_tq</a></span>() +
    <span class="fu">labs</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Simple Test: Frequency of test set"</span>,
         <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"Missing weekends and missing last two weeks of year"</span>) +
    <span class="fu">scale_y_continuous</span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">2.2e6</span>))</pre></body></html></div>
<p><img src="TK02_Making_A_Future_Time_Series_Index_files/figure-html/unnamed-chunk-4-1.png" width="95%" style="display: block; margin: auto;"></p>
<div id="inspect-weekdays" class="section level2">
<h2 class="hasAnchor">
<a href="#inspect-weekdays" class="anchor"></a>Inspect weekdays</h2>
<p><code>inspect_weekdays</code> is useful for finding and removing missing dates that occur on a weekly, bi-weekly, tri-weekly or quad-weekly frequency (such as weekends or every other Friday off). When applied to the example, the algorithm finds and removes omitted weekends of the future data set.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">idx_train</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/tk_make_timeseries.html">tk_make_future_timeseries</a></span>(<span class="kw">n_future</span> <span class="kw">=</span> <span class="fl">395</span>, <span class="kw">inspect_weekdays</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_signature</a></span>() <span class="kw">%&gt;%</span>
    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">index</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">diff</span>)) +
    <span class="fu">geom_line</span>(<span class="kw">color</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/palette_tq.html">palette_light</a></span>()<span class="kw">[[</span><span class="fl">1</span>]]) +
    <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/theme_tq.html">theme_tq</a></span>() +
    <span class="fu">labs</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Simple Test: Frequency of predection with inspect_weekdays = T"</span>,
         <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"Catches missing weekends only"</span>) +
    <span class="fu">scale_y_continuous</span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">2.2e6</span>))</pre></body></html></div>
<p><img src="TK02_Making_A_Future_Time_Series_Index_files/figure-html/unnamed-chunk-5-1.png" width="95%" style="display: block; margin: auto;"></p>
</div>
<div id="inspect-months" class="section level2">
<h2 class="hasAnchor">
<a href="#inspect-months" class="anchor"></a>Inspect months</h2>
<p><code>inspect_months</code> is useful for finding and removing missing dates that occur on a monthly, quarterly, yearly frequency (such as last couple weeks of the year off). Applying to the example, the algorithm finds and removes omitted dates in the last two weeks of the year of the future data set.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">idx</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/tk_make_timeseries.html">tk_make_future_timeseries</a></span>(<span class="kw">n_future</span> <span class="kw">=</span> <span class="fl">395</span>, <span class="kw">inspect_months</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_signature</a></span>() <span class="kw">%&gt;%</span>
    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">index</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">diff</span>)) +
    <span class="fu">geom_line</span>(<span class="kw">color</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/palette_tq.html">palette_light</a></span>()<span class="kw">[[</span><span class="fl">1</span>]]) +
    <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/theme_tq.html">theme_tq</a></span>() +
    <span class="fu">labs</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Simple Test: Frequency of predection with inspect_months = T"</span>,
         <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"Catches missing last two weeks of year only"</span>) +
    <span class="fu">scale_y_continuous</span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">2.2e6</span>))</pre></body></html></div>
<p><img src="TK02_Making_A_Future_Time_Series_Index_files/figure-html/unnamed-chunk-6-1.png" width="95%" style="display: block; margin: auto;"></p>
</div>
<div id="inspect-both-weekdays-and-months" class="section level2">
<h2 class="hasAnchor">
<a href="#inspect-both-weekdays-and-months" class="anchor"></a>Inspect both weekdays and months</h2>
<p>We can combine both <code>inspect_weekdays</code> and <code>inspect_months</code> to detect both sequences of missing dates. Applying both to the example removes the weekends and last two weeks of each year. However, there is one error made due to the interactions of the two algorithms.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">idx_future_wdays_and_months</span> <span class="kw">&lt;-</span> <span class="no">idx_train</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/tk_make_timeseries.html">tk_make_future_timeseries</a></span>(<span class="kw">n_future</span> <span class="kw">=</span> <span class="fl">395</span>, <span class="kw">inspect_weekdays</span> <span class="kw">=</span> <span class="no">T</span>, <span class="kw">inspect_months</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="no">idx_future_wdays_and_months</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_signature</a></span>() <span class="kw">%&gt;%</span>
    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">index</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">diff</span>)) +
    <span class="fu">geom_line</span>(<span class="kw">color</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/palette_tq.html">palette_light</a></span>()<span class="kw">[[</span><span class="fl">1</span>]]) +
    <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/theme_tq.html">theme_tq</a></span>() +
    <span class="fu">labs</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Simple Test: Both inspect_weekdays = T and inspect_months = T"</span>,
         <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"For most part catches missing weekends and last two weeks of year"</span>) +
    <span class="fu">scale_y_continuous</span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">2.2e6</span>))</pre></body></html></div>
<p><img src="TK02_Making_A_Future_Time_Series_Index_files/figure-html/unnamed-chunk-7-1.png" width="95%" style="display: block; margin: auto;"></p>
</div>
<div id="reviewing-errors" class="section level2">
<h2 class="hasAnchor">
<a href="#reviewing-errors" class="anchor"></a>Reviewing errors</h2>
<p>We can inspect further by analyzing both the Type I errors (errors that the algorithm removed incorrectly) and Type II errors (errors that the prediction that algorithm failed to remove).</p>
<div id="type-i-errors" class="section level3">
<h3 class="hasAnchor">
<a href="#type-i-errors" class="anchor"></a>Type I Errors</h3>
<p><strong>Errors that algorithm removed incorrectly</strong>. These errors are the most dangerous because users may not know which days were removed incorrectly. If known, they can be accounted for with <code>insert_values</code>. The easiest way to tell is by reviewing the frequency chart for larger than normal spikes.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">idx_test</span>[!(<span class="no">idx_test</span> <span class="kw">%in%</span> <span class="no">idx_future_wdays_and_months</span>)]</pre></body></html></div>
<pre><code>## Date of length 0</code></pre>
</div>
<div id="type-ii-errors" class="section level3">
<h3 class="hasAnchor">
<a href="#type-ii-errors" class="anchor"></a>Type II Errors</h3>
<p><strong>Errors that algorithm failed to remove</strong>. These errors are the eaisest to manage because typically the analyst generally knows which days should be removed. These errors can be addressed with <code>skip_values</code> provided prediction length is manageable.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">idx_future_wdays_and_months</span>[!(<span class="no">idx_future_wdays_and_months</span> <span class="kw">%in%</span> <span class="no">idx_test</span>)]</pre></body></html></div>
<pre><code>## [1] "2012-12-01"</code></pre>
</div>
</div>
<div id="using-skip-values-and-insert-values" class="section level2">
<h2 class="hasAnchor">
<a href="#using-skip-values-and-insert-values" class="anchor"></a>Using skip values and insert values</h2>
<p><code>insert_values</code> adds values to the future time series, and <code>skip_values</code> removes values from the future time series. The Type I errors (incorrectly removed observations) can be addressed with <code>insert_values</code>. The Type II errors (incorrectly kept observations) can be addressed with <code>skip_values</code>. We had one Type II error in the example, and we’ll correct with <code>skip_values</code>. Make sure the class of the value passed to <code>skip_values</code> matches the class of the time series index.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">idx_future_wdays_months_skip_vals</span> <span class="kw">&lt;-</span> <span class="no">idx_train</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/tk_make_timeseries.html">tk_make_future_timeseries</a></span>(<span class="kw">n_future</span> <span class="kw">=</span> <span class="fl">395</span>,
                              <span class="kw">inspect_weekdays</span> <span class="kw">=</span> <span class="no">T</span>,
                              <span class="kw">inspect_months</span>   <span class="kw">=</span> <span class="no">T</span>,
                              <span class="kw">skip_values</span>      <span class="kw">=</span> <span class="fu">ymd</span>(<span class="st">"2012-12-01"</span>))
<span class="no">idx_future_wdays_months_skip_vals</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_signature</a></span>() <span class="kw">%&gt;%</span>
    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">index</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">diff</span>)) +
    <span class="fu">geom_line</span>(<span class="kw">color</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/palette_tq.html">palette_light</a></span>()<span class="kw">[[</span><span class="fl">1</span>]]) +
    <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/theme_tq.html">theme_tq</a></span>() +
    <span class="fu">labs</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Simple Test: inspect_weekdays = T, inspect_months = T, skip_values"</span>,
         <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"Get the exact solution using skip values"</span>) +
    <span class="fu">scale_y_continuous</span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">2.2e6</span>))</pre></body></html></div>
<p><img src="TK02_Making_A_Future_Time_Series_Index_files/figure-html/unnamed-chunk-10-1.png" width="95%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="example-2-fb-days-traded" class="section level1">
<h1 class="hasAnchor">
<a href="#example-2-fb-days-traded" class="anchor"></a>Example 2: FB days traded</h1>
<p>The FB data from the FANG data set has missing dates that follow primarily a weekly pattern with irregular holidays mixed in. We’ll predict which days will be traded using combinations of <code>inspect_weekdays</code> and <code>inspect_months</code>.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">FB_tbl</span> <span class="kw">&lt;-</span> <span class="no">FANG</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">symbol</span> <span class="kw">%in%</span> <span class="st">"FB"</span>)

<span class="no">FB_train</span> <span class="kw">&lt;-</span> <span class="no">FB_tbl</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="fu">year</span>(<span class="no">date</span>) <span class="kw">&lt;</span> <span class="fl">2016</span>)
<span class="no">FB_test</span>  <span class="kw">&lt;-</span> <span class="no">FB_tbl</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="fu">year</span>(<span class="no">date</span>) <span class="kw">&gt;=</span> <span class="fl">2016</span>)

<span class="no">idx_train</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tk_index.html">tk_index</a></span>(<span class="no">FB_train</span>)
<span class="no">idx_test</span>  <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/tk_index.html">tk_index</a></span>(<span class="no">FB_test</span>)</pre></body></html></div>
<p>Visualize the test index frequency.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">idx_test</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_signature</a></span>() <span class="kw">%&gt;%</span>
    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">index</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">diff</span>)) +
    <span class="fu">geom_line</span>(<span class="kw">color</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/palette_tq.html">palette_light</a></span>()<span class="kw">[[</span><span class="fl">1</span>]]) +
    <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/theme_tq.html">theme_tq</a></span>() +
    <span class="fu">labs</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"FB Test: Frequency of test set"</span>,
         <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"Combination of regularly spaced weekends and irregular holidays"</span>) +
    <span class="fu">scale_y_continuous</span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">2.2e6</span>))</pre></body></html></div>
<p><img src="TK02_Making_A_Future_Time_Series_Index_files/figure-html/unnamed-chunk-12-1.png" width="95%" style="display: block; margin: auto;"></p>
<div id="inspect-weekdays-1" class="section level2">
<h2 class="hasAnchor">
<a href="#inspect-weekdays-1" class="anchor"></a>Inspect weekdays</h2>
<p>Inspecting weekdays gets us pretty close. The algorithm correctly removes weekends. It misses the holidays, which may be acceptable since we can omit easily using <code>skip_values</code>.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="co"># Inspect weekdays: Removes weekends from future series</span>
<span class="no">idx_future_wdays</span> <span class="kw">&lt;-</span> <span class="no">idx_train</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/tk_make_timeseries.html">tk_make_future_timeseries</a></span>(<span class="kw">n_future</span> <span class="kw">=</span> <span class="fl">366</span>, <span class="kw">inspect_weekdays</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">inspect_months</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="co"># Visualize frequency</span>
<span class="no">idx_future_wdays</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_signature</a></span>() <span class="kw">%&gt;%</span>
    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">index</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">diff</span>)) +
    <span class="fu">geom_line</span>(<span class="kw">color</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/palette_tq.html">palette_light</a></span>()<span class="kw">[[</span><span class="fl">1</span>]]) +
    <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/theme_tq.html">theme_tq</a></span>() +
    <span class="fu">labs</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"FB Test: Frequency of predection with only inspect_weekdays = T"</span>,
         <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"Catches weekends, but not holidays"</span>) +
    <span class="fu">scale_y_continuous</span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">2.2e6</span>))</pre></body></html></div>
<p><img src="TK02_Making_A_Future_Time_Series_Index_files/figure-html/unnamed-chunk-13-1.png" width="95%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="co"># Type I Errors</span>
<span class="no">idx_test</span>[!(<span class="no">idx_test</span> <span class="kw">%in%</span> <span class="no">idx_future_wdays</span>)]</pre></body></html></div>
<pre><code>## Date of length 0</code></pre>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="co"># Type II Errors</span>
<span class="no">idx_future_wdays</span>[!(<span class="no">idx_future_wdays</span> <span class="kw">%in%</span> <span class="no">idx_test</span>)]</pre></body></html></div>
<pre><code>## [1] "2016-01-01" "2016-01-18" "2016-02-15" "2016-03-25" "2016-05-30"
## [6] "2016-07-04" "2016-09-05" "2016-11-24" "2016-12-26"</code></pre>
</div>
<div id="inspect-weekdays-and-months" class="section level2">
<h2 class="hasAnchor">
<a href="#inspect-weekdays-and-months" class="anchor"></a>Inspect weekdays and months</h2>
<p>If we apply both inspect weekdays and inspect months the errors actually increase. This is due to the difficulty in predicting holidays (days off throughout the year), which tend to occur with unique rules (e.g. Memorial Day is last Monday of May).</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="co"># Inspect weekdays: Removes weekends from future series</span>
<span class="no">idx_future_wdays_and_months</span> <span class="kw">&lt;-</span> <span class="no">idx_train</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/tk_make_timeseries.html">tk_make_future_timeseries</a></span>(<span class="kw">n_future</span> <span class="kw">=</span> <span class="fl">366</span>, <span class="kw">inspect_weekdays</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">inspect_months</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># Visualize frequency</span>
<span class="no">idx_future_wdays_and_months</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_signature</a></span>() <span class="kw">%&gt;%</span>
    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">index</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">diff</span>)) +
    <span class="fu">geom_line</span>(<span class="kw">color</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/palette_tq.html">palette_light</a></span>()<span class="kw">[[</span><span class="fl">1</span>]]) +
    <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/theme_tq.html">theme_tq</a></span>() +
    <span class="fu">labs</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"FB Test: inspect_weekdays = T and inspect_months = T"</span>,
         <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"For most part catches missing weekends and some holidays, but some incorrect days are removed"</span>) +
    <span class="fu">scale_y_continuous</span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">2.2e6</span>))</pre></body></html></div>
<p><img src="TK02_Making_A_Future_Time_Series_Index_files/figure-html/unnamed-chunk-16-1.png" width="95%" style="display: block; margin: auto;"></p>
<p>We can see that leap year (“2016-02-29”), Incorrect Labor Day (“2016-09-01”, first Monday in September was “2016-09-05”), and New Year’s Eve (“2016-12-30”) were incorrectly removed.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="co"># Type I Errors</span>
<span class="no">idx_test</span>[!(<span class="no">idx_test</span> <span class="kw">%in%</span> <span class="no">idx_future_wdays_and_months</span>)]</pre></body></html></div>
<pre><code>## [1] "2016-02-29" "2016-09-01" "2016-12-30"</code></pre>
<p>The Type II errors were predicted with slightly higher accuracy, but at the expense of Type I errors.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="co"># Type II Errors</span>
<span class="no">idx_future_wdays_and_months</span>[!(<span class="no">idx_future_wdays_and_months</span> <span class="kw">%in%</span> <span class="no">idx_test</span>)]</pre></body></html></div>
<pre><code>## [1] "2016-01-01" "2016-02-15" "2016-03-25" "2016-05-30" "2016-09-05"
## [6] "2016-11-24" "2016-12-26"</code></pre>
</div>
<div id="skip-values" class="section level2">
<h2 class="hasAnchor">
<a href="#skip-values" class="anchor"></a>Skip values</h2>
<p>We can correct for this using the <code>skip_values</code> and <code>inspect_weekdays</code> arguments. The former removes specific observations while the latter uses a logistic regression algorithm to identify the probability of specific weekdays being present in the future index. The algorithm for inspecting weekdays will check for any weekdays that are missing on a weekly, bi-weekly, tri-weekly, or quad-weekly frequency and automatically remove these days. As shown below, holidays and weekends are accounted for.</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="co"># Build vector of holidays in correct timeseries class using ymd()</span>
<span class="no">holidays</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
    <span class="st">"2016-01-01"</span>, <span class="st">"2016-01-18"</span>, <span class="st">"2016-02-15"</span>, <span class="st">"2016-03-25"</span>, <span class="st">"2016-05-30"</span>,
    <span class="st">"2016-07-04"</span>, <span class="st">"2016-09-05"</span>, <span class="st">"2016-11-24"</span>, <span class="st">"2016-12-26"</span>
) <span class="kw">%&gt;%</span> <span class="fu">ymd</span>()

<span class="co"># Create future index</span>
<span class="no">idx_future</span> <span class="kw">&lt;-</span> <span class="no">idx_train</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/tk_make_timeseries.html">tk_make_future_timeseries</a></span>(<span class="kw">n_future</span> <span class="kw">=</span> <span class="fl">366</span>, <span class="kw">inspect_weekdays</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">skip_values</span> <span class="kw">=</span> <span class="no">holidays</span>)

<span class="co"># Plot using ggplot</span>
<span class="no">idx_future</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/tk_get_timeseries.html">tk_get_timeseries_signature</a></span>() <span class="kw">%&gt;%</span>
    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">index</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">diff</span>)) +
    <span class="fu">geom_line</span>(<span class="kw">color</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/palette_tq.html">palette_light</a></span>()<span class="kw">[[</span><span class="fl">1</span>]]) +
    <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/theme_tq.html">theme_tq</a></span>() +
    <span class="fu">labs</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"FB Test: inspect_weekdays = T and skip_values"</span>,
         <span class="kw">subtitle</span> <span class="kw">=</span> <span class="st">"Use weekdays to target frequently occuring dates missed and skip values to target known irregular missing dates"</span>) +
    <span class="fu">scale_y_continuous</span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">2.2e6</span>))</pre></body></html></div>
<p><img src="TK02_Making_A_Future_Time_Series_Index_files/figure-html/unnamed-chunk-19-1.png" width="95%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="parting-thoughts" class="section level1">
<h1 class="hasAnchor">
<a href="#parting-thoughts" class="anchor"></a>Parting Thoughts</h1>
<p>Building the future date sequence is an essential part of forecasting using <code>timetk</code>. An innaccurate date sequence can hurt the performance of the forecast. The <code>tk_make_future_index()</code> function has methods to remove frequently missing dates. However, the user should always review the output to ensure an accurate future date sequence is achieved.</p>
<p>Further, holidays are difficult to predict using <code>inspect_months</code> due to the irregular nature. It is likely better for the user to select <code>inspect_weekdays = TRUE</code> and use <code>skip_values</code> to remove irregular holidays. Use <code>inspect_months</code> when there are missing dates that occur on a monthly, quarterly, or yearly frequency as part of a regular pattern. Use <code>skip_values</code> and <code>insert_values</code> to remove and add dates as necessary to account for irregular missing days.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Matt Dancho, Davis Vaughan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
